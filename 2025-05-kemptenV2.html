<!DOCTYPE HTML>
<html lang="de">
	<head>
		<title>Bike Werners - KemptenV2</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" type="image/x-icon" href="images/BW.ico" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@raruto/leaflet-elevation@2.5.1/dist/leaflet-elevation.min.css" />
		<style>
		  #elevation-div {
		    z-index: 999;
		    position: relative;
		    background: white;
		    margin-bottom: 8em; /* mehr Abstand nach unten */
		    padding-bottom: 2em;
		  }
		</style>

	</head>
	<body class="homepage is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<!-- Bike Werner Logo -->
				<br>
				<br>
				<div align="center">
					<img src="images/BikeWernerLogo.png" alt="" width="33%" height="auto"><br>	
				</div>
			
				<header id="header">
					<div class="logo container">
						<div>
							<h1><a href="#" id="logo">Kempten: 09.05. - 11.05.2025</a></h1>
						</div>
					</div>
				</header>

			<!-- Nav -->			
				<nav id="nav">
					<ul>
						<li class="current"><a href="index.html">Home</a></li>
						<li>
							<a href="#">Geplante Touren</a>
							<ul>
								<li><a href="2025-9-badreichenhall.html">05. - 07.09.2025: Bad Reichenhall</a></li>
								<li><a href="#">2026: tbd</a></li>
							</ul>
						</li>
						<li>
							<a href="absolviertetouren.html">Absolvierte Touren</a>
							<ul>
								<li><a href="2025-5-kempten.html">Kempten 2025</a></li>
								<li><a href="2024-8-ruhpolding.html">Ruhpolding 2024</a></li>
								<li><a href="2024-5-ettal.html">Ettal 2024</a></li>
								<li><a href="2023-9-badwiessee.html">Bad Wiessee 2023</a></li>
								<li><a href="2023-7-bodenmais.html">Bodenmais 2023</a></li>
                						<li><a href="WernersKompakt.html">Werners Kompakt-Touren</a></li>
							</ul>
						</li>
						<li>
							<a href="#">Sonstiges</a>
							<ul>
								<li><a href="wernerstats.html">Wernerstats</a></li>
							</ul>
						</li>
					</ul>
				</nav>

			
			
			<!-- Main -->
				<section id="main">
					<div class="container">
						<div class="row gtr-200">
							<div class="col-12">

								<!-- Features ‚úî‚úîÔ∏è‚ùì‚ùå -->
									<section class="box features">
										<h2 class="major"><span>Teilnehmer</span></h2>
										<ul class="special-images">
										    <li>
										        <img src="images/walzer.jpg" alt="Walzer Werner">
										        <span>Walzer ‚úîÔ∏è</span>
										    </li>
										    <li>
										        <img src="images/wc.jpg" alt="WC Werner">
										        <span>WC  ‚úîÔ∏è</span>
										    </li>
										    <li>
										        <img src="images/windel.jpg" alt="Windel Werner">
										        <span>Windel ‚úîÔ∏è</span>
										    </li>
										    <li>
										        <img src="images/wu.jpg" alt="Wu Werner">
										        <span>Wu ‚úîÔ∏è</span>
										    </li>
										    <li>
										        <img src="images/wurst.jpg" alt="Wurst Werner">
										        <span>Wurst ‚úîÔ∏è</span>
										    </li>
										</ul>
									</section>

							</div>
							
							<div class="col-12">

								<!-- Features -->
									<section class="box features">
										<h2 class="major"><span>Unterkunft</span></h2>
										<div align=center>
											<div class="wernerstats">
												<!-- Button f√ºr Kalendereintrag deaktiviert
												<button onclick="openICS()">Kalendereintrag</button>
													<script>
													function openICS() {
													    window.location.href = "https://bikewerner.github.io/new/iCal/Kempten.ics";
													}
													</script>
												-->
												<p>booking.com: <a href="https://www.booking.com/Share-YWSdi7" target="_blank">Der F√ºrstenhof</a></p>
												<p>-reserviert-</p>
												<!-- <p>bei 4 Personen: 516‚Ç¨ (129,00‚Ç¨ p.P.)</p> -->
												<p>5 Personen: 576‚Ç¨ (115,20‚Ç¨ p.P.)</p>
												<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2683.8404292492924!2d10.315980477447711!3d47.72634607969943!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x479c790e36665ef9%3A0xde25f1af34b37093!2sF%C3%BCrstenhof!5e0!3m2!1sde!2sde!4v1741175625570!5m2!1sde!2sde" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
												<!-- <p>Option 2 506‚Ç¨: <a href="https://www.booking.com/Share-AWH40ky" target="_blank">Landhotel Hirsch</a></p> -->
											</div>
										</div>
									</section>

							</div>
							<div class="col-12">

								<!-- Features -->
									<section class="box features">
										<h2 class="major"><span>Verpflegung</span></h2>
										<div align=center>
											<!-- <p>Freitag Abendessen: folgt...</p> -->
											<p>Freitag Abendessen: <a href="https://maps.app.goo.gl/JrVon8MpPmvSPqak7" target="_blank">Pizzeria Amore Mio</a> - reserviert f√ºr 20:00 Uhr - <a href="https://www.amoremio.pizza/AmoreMioMenue25.pdf?_gl=1*qscqsw*_ga*MTg1NjQ2NzE3OS4xNzI4NDc5MDAy*_ga_ZSD2SFDWLL*MTczODk0OTgzOS4yOC4wLjE3Mzg5NDk4MzkuMC4wLjA." target="_blank">Speisekarte</a></p>
											<p>Samstag Mittagessen: <a href="https://maps.app.goo.gl/xAR9jRZvLQHYWGj67" target="_blank">Beim √ñfner</a> nach 54/105 km</p>
											<!-- <p>Samstag Mittagessen: <a href="https://maps.app.goo.gl/hqjXhdu6wp8nx5nv9" target="_blank">Tauscher's Alm</a> nach 57,2/105km</p> -->
										  	<p>Samstag Abendessen: folgt...</p>
										  	<!-- <p>Samstag Abendessen: <a href="https://maps.app.goo.gl/7ng5jgCmVJ6JnN4x5" target="_blank">Restaurant Bell Ponte</a></p> -->
										</div>
									</section>

							</div>
							<div class="col-12">

								<!-- Features -->
									<section class="box features">
										<h2 class="major"><span>Touren</span></h2>
										<div align=center>
									        	<h3>Freitag: Aufw√§rmrunde</h3>
											<iframe src="https://www.komoot.com/de-de/tour/2086223501/embed?share_token=aGlXqHpeEcNqo4d4Q2geGH16PEthT98453UdETGjFwN8WxX5UH&profile=1" width="100%" height="650" frameborder="0" scrolling="no"></iframe>
											<br>
											<br>
											<br>
									        	<h3>Samstag: Haupttour</h3>
											<p><a href="https://connect.garmin.com/modern/course/340456554" target="_blank">Garmin Connect Import & Download .gpx/.fit</a> (inkl. Berg- & Sprintwertung, Mittagessen)</p>
											<div class="wernerstats">
												<p><img src="images/trikotberg.png" alt="Icon" class="title-icon"> Bergwertung Alte Jochstra√üe <b>bei 42,1 km</b> (Start Anstieg bei 40,1 km: 2,05 km; 260 Hm, √ò Steigung: 12,7 %)</p>
												<p>üçΩÔ∏è Mittagessen <b>bei 54 km</b></p>
												<!-- <p><img src="images/trikotsprint.png" alt="Icon" class="title-icon"> Sprintwertung <b>bei 78,6 km</b></p> -->

												<p onclick="openOverlay('info-sprint')"><img src="images/trikotsprint.png" alt="Icon" class="title-icon"> Sprintwertung <b>bei 78,6 km</b></p>
												
												
										<!-- Overlays f√ºr Bildinfos -->
										<div id="info-sprint" class="overlay">
										    <div class="overlay-content">
										        <span class="close-btn" onclick="closeOverlay('info-sprint')">&times;</span>
											    <div class="wernerstats">
													<ul class="special-images-detail">
														<img src="images/trikotsprint.png" alt="" class="image featured">
													</ul>
													<div class="header-wrapper">
														<h3>Sprintwertung</h3>
													</div>
											    </div> 
										    </div>
										</div>












												

												
											</div>
											<iframe src="https://www.komoot.com/de-de/tour/2225477545/embed?share_token=aEH8xlpkndtjcRDc2fXG6X3Y92t0hsYkZq0uLHQ8FUwJgfDzSU&profile=1" width="100%" height="650" frameborder="0" scrolling="no"></iframe>
											<h3>Recap: Haupttour</h3>
											<!--
											<video width="640" height="360" controls>
											  <source src="videos/kempten.mp4" type="video/mp4">
											</video>
											-->
										</div>
									</section>
<section class="box features">
  <h2 class="major"><span>Touren & Wetter</span></h2>

  <!-- Eingabefelder -->
  <div style="margin-bottom:1em; font-family:sans-serif;">
    <label for="starttime">üö¥ Tourstart (Datum & Uhrzeit):</label>
    <input type="datetime-local" id="starttime" value="2025-05-25T10:00">

    <label for="avgSpeed" style="margin-left:1em;">√ò-Geschwindigkeit (km/h):</label>
    <input type="number" id="avgSpeed" value="20" min="5" max="50" step="1" style="width:60px;">

    <br><br>

    <label for="pauseAtKm">üõë Pause bei (km):</label>
    <input type="number" id="pauseAtKm" value="53" min="1" step="0.1" style="width:60px;">

    <label for="pauseDuration" style="margin-left:1em;">‚è±Ô∏è Pausendauer (hh:mm):</label>
    <input type="time" id="pauseDuration" value="01:15">

    <br><br>

    <button id="loadWeatherBtn">Wetter abrufen</button>
  </div>

  <!-- Info-Anzeige -->
  <div id="infoBox" style="margin-top:1em; font-family:sans-serif;"></div>

  <!-- Karte -->
  <div id="map" style="width:100%; height:500px;"></div>
  <div id="elevation-div" style="width:100%; height:250px; margin-top:1em;"></div>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.5.0/gpx.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@raruto/leaflet-elevation@2.5.1/dist/leaflet-elevation.min.js"></script>	

  <script>
    const apiKey = '6051678f687734a26fbc6c962e0b4820';
    const gpxPath = 'gpx/WernersKemptenTannheimerTal.gpx';

    const map = L.map('map').setView([47.7, 10.3], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const elevationControl = L.control.elevation({
      theme: "lightblue",
      detached: true,
      elevationDiv: "#elevation-div"
    });
    elevationControl.addTo(map);

    const gpxLayer = new L.GPX(gpxPath, {
      async: true,
      marker_options: { startIconUrl: null, endIconUrl: null, shadowUrl: null },
      polyline_options: { color: '#008800', weight: 3, opacity: 0.75 }
    }).on("loaded", e => map.fitBounds(e.target.getBounds()))
      .on("addline", e => elevationControl.addData(e.line))
      .addTo(map);

    const weatherLayer = L.layerGroup().addTo(map);

    // Funktion zur Distanzberechnung (Haversine)
    function distance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const toRad = deg => deg * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2)**2 +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }

    async function loadWeather() {
      weatherLayer.clearLayers();
      const btn = document.getElementById('loadWeatherBtn');
      btn.textContent = 'Lade‚Ä¶';
      btn.disabled = true;

      const startTime = new Date(document.getElementById('starttime').value);
      const avgSpeed = parseFloat(document.getElementById('avgSpeed').value || '20');
      const pauseAtKm = parseFloat(document.getElementById('pauseAtKm').value || '0');
      const pauseDurationStr = document.getElementById('pauseDuration').value || '00:00';
      const [pauseH, pauseM] = pauseDurationStr.split(':').map(Number);
      const pauseDurationMin = pauseH * 60 + pauseM;

      if (isNaN(startTime) || isNaN(avgSpeed) || avgSpeed <= 0) {
        alert('Bitte g√ºltige Startzeit und Geschwindigkeit eingeben.');
        btn.textContent = 'Wetter abrufen';
        btn.disabled = false;
        return;
      }

      // GPX laden & Trackpunkte extrahieren
      const resp = await fetch(gpxPath);
      const gpxText = await resp.text();
      const xml = new DOMParser().parseFromString(gpxText,'application/xml');
      const trkpts = Array.from(xml.getElementsByTagName('trkpt'))
        .map(pt => ({
          lat: +pt.getAttribute('lat'),
          lon: +pt.getAttribute('lon')
        }));

      // Gesamtdistanz berechnen
      let totalDist = 0;
      for (let i = 1; i < trkpts.length; i++) {
        totalDist += distance(trkpts[i-1].lat, trkpts[i-1].lon, trkpts[i].lat, trkpts[i].lon);
      }

      const totalDurationMin = (totalDist / avgSpeed) * 60 + (totalDist >= pauseAtKm ? pauseDurationMin : 0);
      const arrivalTime = new Date(startTime.getTime() + totalDurationMin * 60000);

      // Wetterpunkte entlang der Strecke
      const totalPoints = Math.min(10, trkpts.length);
      const selected = [];

      for (let i = 0; i < totalPoints; i++) {
        const fraction = i / (totalPoints - 1);
        const idx = Math.floor(fraction * (trkpts.length - 1));

        let distUntilPoint = 0;
        for (let j = 1; j <= idx; j++) {
          distUntilPoint += distance(trkpts[j - 1].lat, trkpts[j - 1].lon, trkpts[j].lat, trkpts[j].lon);
        }

        let timeMin = (distUntilPoint / avgSpeed) * 60;
        if (distUntilPoint >= pauseAtKm) timeMin += pauseDurationMin;

        selected.push({
          ...trkpts[idx],
          time: new Date(startTime.getTime() + timeMin * 60000)
        });
      }

      let temps = [], rains = [], rainProbs = [];

      for (let pt of selected) {
        const date = pt.time.toISOString().slice(0,10);
        const hour = pt.time.getHours();
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${pt.lat}&longitude=${pt.lon}&hourly=temperature_2m,precipitation_probability,precipitation,wind_speed_10m&start_date=${date}&end_date=${date}&timezone=auto`;
        const w = await fetch(url).then(r => r.json());
        const idx = w.hourly.time.findIndex(t => new Date(t).getHours() === hour);
        if (idx < 0) continue;

        const temp = w.hourly.temperature_2m[idx];
        const rain = w.hourly.precipitation[idx];
        const rainProb = w.hourly.precipitation_probability?.[idx] ?? "‚Äì";
        const wind = w.hourly.wind_speed_10m[idx];

        temps.push(temp);
        rains.push(rain);
		rainProbs.push(rainProb);

        const label = `
          <b>${pt.time.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</b><br>
          üå°Ô∏è ${temp}¬∞C<br>
          üåßÔ∏è ${rain} mm (${rainProb}%)<br>
          üí® ${wind} km/h`;

        L.marker([pt.lat, pt.lon]).bindPopup(label).addTo(weatherLayer);
      }

      const minTemp = Math.min(...temps);
      const maxTemp = Math.max(...temps);
      const avgTemp = temps.reduce((a,b)=>a+b,0) / temps.length;
      const totalRain = rains.reduce((a,b)=>a+b,0);
      const avgRainProb = Math.round(rainProbs.reduce((a,b)=>a + (+b || 0), 0) / rainProbs.length);

      const infoBox = document.getElementById('infoBox');
      infoBox.innerHTML = `
        <p><strong>Distanz:</strong> ${totalDist.toFixed(1)}‚ÄØkm</p>
        <p><strong>Fahrtdauer:</strong> ${Math.floor(totalDurationMin/60)}:${String(Math.round(totalDurationMin%60)).padStart(2,'0')}‚ÄØh</p>
        <p><strong>Ankunft:</strong> ${arrivalTime.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</p>
        <p><strong>Temperatur:</strong> Min ${minTemp.toFixed(1)}¬∞C, Max ${maxTemp.toFixed(1)}¬∞C, √ò ${avgTemp.toFixed(1)}¬∞C</p>
        <p><strong>Niederschlag:</strong> ${totalRain.toFixed(1)} mm (gesamt), ‚åÄ Wahrscheinlichkeit: ${avgRainProb}%</p>
      `;

      btn.textContent = 'Wetter abrufen';
      btn.disabled = false;
    }

    document.getElementById('loadWeatherBtn')
      .addEventListener('click', loadWeather);
	  // Synchronisierung der Mausbewegung √ºber die Karte, wenn man im  H√∂henprofil ist      
// Synchronisierung der Mausbewegung √ºber das H√∂henprofil mit einem Marker auf der Karte
function updateHoverMarker(latlng) {
  if (!window.elevationHoverMarker) {
    window.elevationHoverMarker = L.circleMarker(latlng, {
      radius: 6,
      color: "#f00",
      weight: 2,
      fillOpacity: 0.6
    }).addTo(map);
  } else {
    window.elevationHoverMarker.setLatLng(latlng);
  }
}

elevationControl.on("mousemove", function(evt) {
  if (evt.latlng) updateHoverMarker(evt.latlng);
});

elevationControl.on("mouseover", function(evt) {
  if (evt.latlng) updateHoverMarker(evt.latlng);
});

elevationControl.on("mouseout", function(evt) {
  if (window.elevationHoverMarker) {
    map.removeLayer(window.elevationHoverMarker);
    window.elevationHoverMarker = null;
  }
});
    
      
	  // Synchronisierung der Mausbewegung √ºber das H√∂henprofil mit einem Marker auf der Karte
		elevationControl.on("mousemove", function(evt) {
		  if (!evt.latlng) return;
		  if (!window.elevationHoverMarker) {
		    window.elevationHoverMarker = L.circleMarker(evt.latlng, {
		      radius: 6,
		      color: "#f00",
		      weight: 2,
		      fillOpacity: 0.6
		    }).addTo(map);
		  } else {
		    window.elevationHoverMarker.setLatLng(evt.latlng);
		  }
		});

		elevationControl.on("mouseout", function(evt) {
		  if (window.elevationHoverMarker) {
		    map.removeLayer(window.elevationHoverMarker);
		    window.elevationHoverMarker = null;
		  }
		});
  </script>
</section>




								

							</div>
							<br>
							<br>
							<div class="col-12">
								<section class="box features">
									<h2 class="major"><span>Absolvierte Touren</span></h2>
									<div>
								        	<div id="row" class="row"></div>
								            		<script>
									                fetch("pages/absolviertetourenfooter.html")
									                    .then(response => response.text())
									                    .then(data => document.getElementById("row").innerHTML = data)
									                    .catch(error => console.error("Fehler beim Laden der Datei:", error));
								            		</script>
							        		</div>    
								</section>
							</div>

						</div>
					</div>
				</section>

			<!-- Footer -->
				<footer id="footer">
					<div class="container">
						<!-- Copyright -->
							<div id="copyright">
								<ul class="menu">
									<li>&copy; Bike Werners. All rights reserved</li>
								</ul>
							</div>

					</div>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/overlay.js"></script>
	</body>
</html>
