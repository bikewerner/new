<!DOCTYPE HTML>
<html lang="de">
	<head>
		<title>Bike Werners - Kempten</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" type="image/x-icon" href="images/BW.ico" />
	</head>
	<body class="homepage is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<!-- Bike Werner Logo -->
				<br>
				<br>
				<div align="center">
					<img src="images/BikeWernerLogo.png" alt="" width="33%" height="auto"><br>	
				</div>
			
				<header id="header">
					<div class="logo container">
						<div>
							<h1><a href="#" id="logo">Kempten: 09.05. - 11.05.2025</a></h1>
						</div>
					</div>
				</header>

			
				<nav id="nav">
					<ul>
						<li class="current"><a href="index.html">Home</a></li>
						<li>
							<a href="#">Geplante Touren</a>
							<ul>
								<li><a href="2025-05-kempten.html">09. - 11.05.2025: Kempten</a></li>
								<li><a href="#">04. - 06.07.2025: tbd</a></li>
								<li><a href="#">05. - 07.09.2025: tbd</a></li>							
							</ul>
						</li>
						<li>
							<a href="absolviertetouren.html">Absolvierte Touren</a>
							<ul>
								<li><a href="2024-8-ruhpolding.html">Ruhpolding 2024</a></li>
								<li><a href="2024-5-ettal.html">Ettal 2024</a></li>
								<li><a href="2023-9-badwiessee.html">Bad Wiessee 2023</a></li>
								<li><a href="2023-7-bodenmais.html">Bodenmais 2023</a></li>
							</ul>
						</li>
						<li>
							<a href="#">Sonstiges</a>
							<ul>
								<li><a href="wernerstats.html">Wernerstats</a></li>
							</ul>
						</li>
					</ul>
				</nav>

			
			
			<!-- Main -->
				<section id="main">
					<div class="container">
						<div class="row gtr-200">
							<div class="col-12">

								<!-- Features âœ”âœ”ï¸â“âŒ -->
									<section class="box features">
										<h2 class="major"><span>Teilnehmer</span></h2>
										<ul class="special-images">
										    <li>
										        <img src="images/walzer.jpg" alt="Walzer Werner">
										        <span>Walzer âœ”ï¸</span>
										    </li>
										    <li>
										        <img src="images/wc.jpg" alt="WC Werner">
										        <span>WC  âœ”ï¸</span>
										    </li>
										    <li>
										        <img src="images/windel.jpg" alt="Windel Werner">
										        <span>Windel âœ”ï¸</span>
										    </li>
										    <li>
										        <img src="images/wu.jpg" alt="Wu Werner">
										        <span>Wu âœ”ï¸</span>
										    </li>
										    <li>
										        <img src="images/wurst.jpg" alt="Wurst Werner">
										        <span>Wurst âœ”ï¸</span>
										    </li>
										</ul>
									</section>

							</div>
							
							<div class="col-12">

								<!-- Features -->
									<section class="box features">
										<h2 class="major"><span>Unterkunft</span></h2>
										<div align=center>
											<div class="wernerstats">
												<!-- Button fÃ¼r Kalendereintrag deaktiviert
												<button onclick="openICS()">Kalendereintrag</button>
													<script>
													function openICS() {
													    window.location.href = "https://bikewerner.github.io/new/iCal/Kempten.ics";
													}
													</script>
												-->
												<p>booking.com: <a href="https://www.booking.com/Share-YWSdi7" target="_blank">Der FÃ¼rstenhof</a></p>
												<p>-reserviert-</p>
												<!-- <p>bei 4 Personen: 516â‚¬ (129,00â‚¬ p.P.)</p> -->
												<p>5 Personen: 576â‚¬ (115,20â‚¬ p.P.)</p>
												<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2683.8404292492924!2d10.315980477447711!3d47.72634607969943!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x479c790e36665ef9%3A0xde25f1af34b37093!2sF%C3%BCrstenhof!5e0!3m2!1sde!2sde!4v1741175625570!5m2!1sde!2sde" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
												<!-- <p>Option 2 506â‚¬: <a href="https://www.booking.com/Share-AWH40ky" target="_blank">Landhotel Hirsch</a></p> -->
											</div>
										</div>
									</section>

							</div>
							<div class="col-12">

								<!-- Features -->
									<section class="box features">
										<h2 class="major"><span>Verpflegung</span></h2>
										<div align=center>
											<!-- <p>Freitag Abendessen: folgt...</p> -->
											<p>Freitag Abendessen: <a href="https://maps.app.goo.gl/JrVon8MpPmvSPqak7" target="_blank">Pizzeria Amore Mio</a> - reserviert fÃ¼r 20:00 Uhr - <a href="https://www.amoremio.pizza/AmoreMioMenue25.pdf?_gl=1*qscqsw*_ga*MTg1NjQ2NzE3OS4xNzI4NDc5MDAy*_ga_ZSD2SFDWLL*MTczODk0OTgzOS4yOC4wLjE3Mzg5NDk4MzkuMC4wLjA." target="_blank">Speisekarte</a></p>
											<p>Samstag Mittagessen: <a href="https://maps.app.goo.gl/xAR9jRZvLQHYWGj67" target="_blank">Beim Ã–fner</a> nach 54/105 km</p>
											<!-- <p>Samstag Mittagessen: <a href="https://maps.app.goo.gl/hqjXhdu6wp8nx5nv9" target="_blank">Tauscher's Alm</a> nach 57,2/105km</p> -->
										  	<p>Samstag Abendessen: folgt...</p>
										  	<!-- <p>Samstag Abendessen: <a href="https://maps.app.goo.gl/7ng5jgCmVJ6JnN4x5" target="_blank">Restaurant Bell Ponte</a></p> -->
										</div>
									</section>

							</div>
							<div class="col-12">

								<!-- Features -->
									<section class="box features">
										<h2 class="major"><span>Touren</span></h2>
										<div align=center>
									        	<h3>Freitag: AufwÃ¤rmrunde</h3>
											<iframe src="https://www.komoot.com/de-de/tour/2086223501/embed?share_token=aGlXqHpeEcNqo4d4Q2geGH16PEthT98453UdETGjFwN8WxX5UH&profile=1" width="100%" height="650" frameborder="0" scrolling="no"></iframe>
											<br>
											<br>
											<br>
									        	<h3>Samstag: Haupttour</h3>
											<p><a href="https://connect.garmin.com/modern/course/340456554" target="_blank">Garmin Connect Import & Download .gpx/.fit</a> (inkl. Berg- & Sprintwertung, Mittagessen)</p>
											<div class="wernerstats">
												<p><img src="images/trikotberg.png" alt="Icon" class="title-icon"> Bergwertung Alte JochstraÃŸe <b>bei 42,1 km</b> (Start Anstieg bei 40,1 km: 2,05 km; 260 Hm, Ã˜ Steigung: 12,7 %)</p>
												<p>ğŸ½ï¸ Mittagessen <b>bei 54 km</b></p>
												<p><img src="images/trikotsprint.png" alt="Icon" class="title-icon"> Sprintwertung <b>bei 78,6 km</b></p>
											</div>
											<iframe src="https://www.komoot.com/de-de/tour/2083088614/embed?share_token=aUjiVsL6iBNyFZdwLAl02d6NmKPUJvuWwBwU7NBUsTvxsMiXy6&profile=1" width="100%" height="650" frameborder="0" scrolling="no"></iframe>


<!-- Wetter entlang der Route mit Startzeit -->
<div style="padding: 1em; font-family: sans-serif;">
  <label for="starttime">ğŸš´ Tourstart (Datum & Uhrzeit):</label>
  <input type="datetime-local" id="starttime" value="2025-05-05T08:00">
  <button onclick="loadWeather()">Wetter abrufen</button>
</div>
<div id="weather-status" style="padding: 1em; font-family: sans-serif;"></div>

<script>
let weatherLayer = L.layerGroup().addTo(map);

async function loadWeather() {
  const status = document.getElementById("weather-status");
  status.innerHTML = "â³ Lade Wetterdaten...";
  weatherLayer.clearLayers();

  const startTimeStr = document.getElementById("starttime").value;
  const startTime = new Date(startTimeStr);
  if (isNaN(startTime)) {
    status.innerHTML = "âŒ UngÃ¼ltiges Datum.";
    return;
  }

  const response = await fetch('gpx/WernersKemptenTannheimerTal.gpx');
  const gpxText = await response.text();
  const parser = new DOMParser();
  const gpx = parser.parseFromString(gpxText, "application/xml");
  const trkpts = gpx.getElementsByTagName("trkpt");

  if (trkpts.length === 0) {
    status.innerHTML = "âŒ Keine Route gefunden.";
    return;
  }

  let points = [];
  for (let i = 0; i < trkpts.length; i++) {
    const lat = parseFloat(trkpts[i].getAttribute("lat"));
    const lon = parseFloat(trkpts[i].getAttribute("lon"));
    points.push([lat, lon]);
  }

  const totalPoints = 8; // alle 30 Minuten bei ca. 4h Tourdauer
  const step = Math.floor(points.length / totalPoints);
  const selectedPoints = [];
  for (let i = 0; i < totalPoints; i++) {
    selectedPoints.push({
      lat: points[i * step][0],
      lon: points[i * step][1],
      time: new Date(startTime.getTime() + i * 30 * 60 * 1000)
    });
  }

  const results = [];
  for (let pt of selectedPoints) {
    const isoDate = pt.time.toISOString().split("T")[0];
    const hour = pt.time.getHours();
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${pt.lat}&longitude=${pt.lon}&hourly=temperature_2m,precipitation,wind_speed_10m&timezone=auto&start_date=${isoDate}&end_date=${isoDate}`;
    const res = await fetch(url);
    const data = await res.json();

    const idx = data.hourly.time.findIndex(t => new Date(t).getHours() === hour);
    if (idx !== -1) {
      const result = {
        time: pt.time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
        lat: pt.lat.toFixed(3),
        lon: pt.lon.toFixed(3),
        temp: data.hourly.temperature_2m[idx],
        rain: data.hourly.precipitation[idx],
        wind: data.hourly.wind_speed_10m[idx]
      };
      results.push(result);

      // FÃ¼ge Marker auf der Karte hinzu
      const marker = L.marker([pt.lat, pt.lon]).addTo(weatherLayer);
      marker.bindPopup(`<b>${result.time}</b><br>ğŸŒ¡ï¸ ${result.temp}Â°C<br>ğŸŒ§ï¸ ${result.rain} mm<br>ğŸ’¨ ${result.wind} km/h`);
    }
  }

  status.innerHTML = "<b>ğŸŒ¦ï¸ Wetter entlang der Route:</b><ul>" + results.map(r =>
    `<li><b>${r.time}</b> @ [${r.lat}, ${r.lon}]: ğŸŒ¡ï¸ ${r.temp}Â°C, ğŸŒ§ï¸ ${r.rain} mm, ğŸ’¨ ${r.wind} km/h</li>`
  ).join("") + "</ul>";
}
</script>

<!-- Wetter entlang der Route mit Startzeit -->
<div style="padding: 1em; font-family: sans-serif;">
  <label for="starttime">ğŸš´ Tourstart (Datum & Uhrzeit):</label>
  <input type="datetime-local" id="starttime" value="2025-05-05T08:00">
  <button onclick="loadWeather()">Wetter abrufen</button>
</div>
<div id="weather-status" style="padding: 1em; font-family: sans-serif;"></div>

<script>
async function loadWeather() {
  const status = document.getElementById("weather-status");
  status.innerHTML = "â³ Lade Wetterdaten...";

  const startTimeStr = document.getElementById("starttime").value;
  const startTime = new Date(startTimeStr);
  if (isNaN(startTime)) {
    status.innerHTML = "âŒ UngÃ¼ltiges Datum.";
    return;
  }

  const response = await fetch('gpx/WernersKemptenTannheimerTal.gpx');
  const gpxText = await response.text();
  const parser = new DOMParser();
  const gpx = parser.parseFromString(gpxText, "application/xml");
  const trkpts = gpx.getElementsByTagName("trkpt");

  if (trkpts.length === 0) {
    status.innerHTML = "âŒ Keine Route gefunden.";
    return;
  }

  let points = [];
  for (let i = 0; i < trkpts.length; i++) {
    const lat = parseFloat(trkpts[i].getAttribute("lat"));
    const lon = parseFloat(trkpts[i].getAttribute("lon"));
    points.push([lat, lon]);
  }

  const totalPoints = 8; // alle 30 Minuten bei ca. 4h Tourdauer
  const step = Math.floor(points.length / totalPoints);
  const selectedPoints = [];
  for (let i = 0; i < totalPoints; i++) {
    selectedPoints.push({
      lat: points[i * step][0],
      lon: points[i * step][1],
      time: new Date(startTime.getTime() + i * 30 * 60 * 1000) // +30min je Punkt
    });
  }

  // Wetter abrufen fÃ¼r alle Punkte
  const results = [];
  for (let pt of selectedPoints) {
    const isoDate = pt.time.toISOString().split("T")[0];
    const hour = pt.time.getHours();
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${pt.lat}&longitude=${pt.lon}&hourly=temperature_2m,precipitation,wind_speed_10m&timezone=auto&start_date=${isoDate}&end_date=${isoDate}`;
    const res = await fetch(url);
    const data = await res.json();

    const idx = data.hourly.time.findIndex(t => new Date(t).getHours() === hour);
    if (idx !== -1) {
      results.push({
        time: pt.time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
        lat: pt.lat.toFixed(3),
        lon: pt.lon.toFixed(3),
        temp: data.hourly.temperature_2m[idx],
        rain: data.hourly.precipitation[idx],
        wind: data.hourly.wind_speed_10m[idx]
      });
    }
  }

  // Ergebnisse anzeigen
  status.innerHTML = "<b>ğŸŒ¦ï¸ Wetter entlang der Route:</b><ul>" + results.map(r =>
    `<li><b>${r.time}</b> @ [${r.lat}, ${r.lon}]: ğŸŒ¡ï¸ ${r.temp}Â°C, ğŸŒ§ï¸ ${r.rain} mm, ğŸ’¨ ${r.wind} km/h</li>`
  ).join("") + "</ul>";
}
</script>

<div id="weather-status" style="padding: 1em; font-family: sans-serif;"></div>
<script>
// Wettercode kommt hier rein
</script>



											
											<!-- Wetter entlang der Route -->
											<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
											<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
											<script src="https://unpkg.com/leaflet-gpx/gpx.min.js"></script>
											
											<div id="weather-map" style="width: 100%; height: 500px; margin-top: 2rem;"></div>
											
											<script>
											  const map = L.map('weather-map').setView([47.7, 10.3], 10); // Region AllgÃ¤u
											  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
											    attribution: '&copy; OpenStreetMap contributors'
											  }).addTo(map);
											
											  const apiKey = '6051678f687734a26fbc6c962e0b4820';
											  const gpxFile = 'gpx/WernersKemptenTannheimerTal.gpx';
											
											  const gpx = new L.GPX(gpxFile, {
											    async: true,
											    marker_options: {
											      startIconUrl: null,
											      endIconUrl: null,
											      shadowUrl: null
											    }
											  }).on('loaded', function(e) {
											    map.fitBounds(e.target.getBounds());
											
											    const trackpoints = e.target.get_layers()[0].getLatLngs();
											    const sampleIntervalKm = 10; // ca. 30 Minuten bei 20 km/h
											
											    let sampledPoints = [];
											    let accumulatedDistance = 0;
											
											    for (let i = 1; i < trackpoints.length; i++) {
											      const dist = trackpoints[i - 1].distanceTo(trackpoints[i]) / 1000; // in km
											      accumulatedDistance += dist;
											      if (accumulatedDistance >= sampleIntervalKm) {
											        sampledPoints.push(trackpoints[i]);
											        accumulatedDistance = 0;
											      }
											    }
											
											    sampledPoints.forEach((point, idx) => {
											      const lat = point.lat;
											      const lon = point.lng;
											      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`;
											
											      fetch(url)
											        .then(response => response.json())
											        .then(data => {
											          const weather = data.weather[0].description;
											          const temp = data.main.temp;
											          const wind = data.wind.speed;
											          const icon = data.weather[0].icon;
											          const popup = `
											            <b>Wetter</b><br>
											            ${weather}<br>
											            ğŸŒ¡ï¸ ${temp}Â°C<br>
											            ğŸ’¨ ${wind} m/s<br>
											            <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${weather}">
											          `;
											          L.marker([lat, lon]).addTo(map).bindPopup(popup);
											        });
											    });
											  }).addTo(map);
											</script>
											<!-- Wetter entlang der Route -->
											
										</div>
									</section>

							</div>
							
							<div class="col-12">
								<section class="box features">
									<h2 class="major"><span>Absolvierte Touren</span></h2>
									<div>
								        	<div id="row" class="row"></div>
								            		<script>
									                fetch("pages/absolviertetourenfooter.html")
									                    .then(response => response.text())
									                    .then(data => document.getElementById("row").innerHTML = data)
									                    .catch(error => console.error("Fehler beim Laden der Datei:", error));
								            		</script>
							        		</div>    
								</section>
							</div>

						</div>
					</div>
				</section>

			<!-- Footer -->
				<footer id="footer">
					<div class="container">
						<!-- Copyright -->
							<div id="copyright">
								<ul class="menu">
									<li>&copy; Bike Werners. All rights reserved</li>
								</ul>
							</div>

					</div>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
	</body>
</html>
