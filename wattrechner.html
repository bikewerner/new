<!DOCTYPE HTML>
<html lang="de">
	<head>
		<title>Bike Werners - Wattrechner</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" type="image/x-icon" href="images/BW.ico" />
	</head>
	<body class="homepage is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<!-- Bike Werner Logo -->
				<br>
				<br>
				<div align="center">
					<img src="images/BikeWernerLogo.png" alt="" width="33%" height="auto"><br>	
				</div>
			
				<header id="header">
					<div class="logo container">
						<div>
							<h1><a href="#" id="logo">Wattrechner</a></h1>
						</div>
					</div>
				</header>

			<!-- Nav -->
				<nav id="nav">
					<ul>
						<li class="current"><a href="index.html">Home</a></li>
						<li>
							<a href="#">Geplante Touren</a>
							<ul>
								<li><a href="2025-05-kempten.html">09. - 11.05.2025: Kempten</a></li>
								<li><a href="#">18. - 20.07.2025: tbd</a></li>
								<li><a href="#">05. - 07.09.2025: tbd</a></li>							
							</ul>
						</li>
						<li>
							<a href="absolviertetouren.html">Absolvierte Touren</a>
							<ul>
								<li><a href="2024-8-ruhpolding.html">Ruhpolding 2024</a></li>
								<li><a href="2024-5-ettal.html">Ettal 2024</a></li>
								<li><a href="2023-9-badwiessee.html">Bad Wiessee 2023</a></li>
								<li><a href="2023-7-bodenmais.html">Bodenmais 2023</a></li>
							</ul>
						</li>
						<li>
							<a href="#">Sonstiges</a>
							<ul>
								<li><a href="wernerstats.html">Wernerstats</a></li>
								<li><a href="howto.html">How-To</a></li>
                						<li><a href="wattrechner.html">Wattrechner</a></li>
							</ul>
						</li>
					</ul>
				</nav>	
				

			<!-- Main -->
				<section id="main">
    <div class="container">
        <h2>Wattrechner für Bergtouren</h2>
        
        <div class="input-group">
            <label for="gpxFile">GPX-Datei hochladen:</label>
            <input type="file" id="gpxFile" accept=".gpx">
        </div>

        <div class="input-group">
            <label for="gewicht">Gesamtgewicht (Fahrer + Rad) in kg:</label>
            <input type="number" id="gewicht" value="75">
        </div>

        <div class="input-group">
            <label for="steigung">Steigung in %:</label>
            <input type="number" id="steigung" placeholder="Automatisch aus GPX">
        </div>

        <div class="input-group">
            <label for="hoehenmeter">Höhenmeter des Anstiegs in m:</label>
            <input type="number" id="hoehenmeter" placeholder="Automatisch aus GPX">
        </div>

        <div class="input-group">
            <label for="distanz">Distanz des Anstiegs in km:</label>
            <input type="number" id="distanz" placeholder="Automatisch aus GPX">
        </div>

        <button onclick="berechneWattUndKadenz()">Berechnen</button>
        <h3>Benötigte Leistung: <span id="ergebnis">0</span> Watt</h3>
        <h3>Kadenz: <span id="kadenz">0</span> U/min</h3>
    </div>

    <script>
        function parseGPX(file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(event.target.result, "application/xml");
                const trkpts = xmlDoc.getElementsByTagName("trkpt");
                
                let totalDist = 0;
                let totalElevGain = 0;
                let prevLat = null, prevLon = null, prevElev = null;

                for (let i = 0; i < trkpts.length; i++) {
                    const lat = parseFloat(trkpts[i].getAttribute("lat"));
                    const lon = parseFloat(trkpts[i].getAttribute("lon"));
                    const elev = parseFloat(trkpts[i].getElementsByTagName("ele")[0].textContent);
                    
                    if (prevLat !== null && prevLon !== null) {
                        const dist = haversineDistance(prevLat, prevLon, lat, lon);
                        totalDist += dist;
                        if (elev > prevElev) {
                            totalElevGain += (elev - prevElev);
                        }
                    }
                    prevLat = lat;
                    prevLon = lon;
                    prevElev = elev;
                }
                
                document.getElementById("distanz").value = (totalDist / 1000).toFixed(2);
                document.getElementById("hoehenmeter").value = totalElevGain.toFixed(2);
                document.getElementById("steigung").value = ((totalElevGain / totalDist) * 100).toFixed(2);
            };
            reader.readAsText(file);
        }

        function haversineDistance(lat1, lon1, lat2, lon2) {
            const R = 6371000; // Erdradius in m
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        document.getElementById("gpxFile").addEventListener("change", function(event) {
            parseGPX(event.target.files[0]);
        });
    </script>


				</section>

			<!-- Footer -->
				<footer id="footer">
					<div class="container">
						<!-- Copyright -->
							<div id="copyright">
								<ul class="menu">
									<li>&copy; Bike Werners. All rights reserved</li>
								</ul>
							</div>

					</div>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/wernerstats.js"></script>

	</body>
</html>
