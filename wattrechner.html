<!DOCTYPE HTML>
<html lang="de">
	<head>
		<title>Bike Werners - Wattrechner</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" type="image/x-icon" href="images/BW.ico" />
	</head>
	<body class="homepage is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<!-- Bike Werner Logo -->
				<br>
				<br>
				<div align="center">
					<img src="images/BikeWernerLogo.png" alt="" width="33%" height="auto"><br>	
				</div>
			
				<header id="header">
					<div class="logo container">
						<div>
							<h1><a href="#" id="logo">Wattrechner</a></h1>
						</div>
					</div>
				</header>

			<!-- Nav -->
				<nav id="nav">
					<ul>
						<li class="current"><a href="index.html">Home</a></li>
						<li>
							<a href="#">Geplante Touren</a>
							<ul>
								<li><a href="2025-05-kempten.html">09. - 11.05.2025: Kempten</a></li>
								<li><a href="#">18. - 20.07.2025: tbd</a></li>
								<li><a href="#">05. - 07.09.2025: tbd</a></li>							
							</ul>
						</li>
						<li>
							<a href="absolviertetouren.html">Absolvierte Touren</a>
							<ul>
								<li><a href="2024-8-ruhpolding.html">Ruhpolding 2024</a></li>
								<li><a href="2024-5-ettal.html">Ettal 2024</a></li>
								<li><a href="2023-9-badwiessee.html">Bad Wiessee 2023</a></li>
								<li><a href="2023-7-bodenmais.html">Bodenmais 2023</a></li>
							</ul>
						</li>
						<li>
							<a href="#">Sonstiges</a>
							<ul>
								<li><a href="wernerstats.html">Wernerstats</a></li>
								<li><a href="howto.html">How-To</a></li>
                						<li><a href="wattrechner.html">Wattrechner</a></li>
							</ul>
						</li>
					</ul>
				</nav>	
				

			<!-- Main -->
				<section id="main">
    <div class="container">
        <h2>Wattrechner für Bergtouren</h2>
        
        <div class="input-group">
            <label for="gpxFile">GPX-Datei hochladen:</label>
            <input type="file" id="gpxFile" accept=".gpx" onchange="parseGPX()">
        </div>

        <div class="input-group">
            <label for="gewicht">Gesamtgewicht (Fahrer + Rad) in kg:</label>
            <input type="number" id="gewicht" value="75">
        </div>

        <div class="input-group">
            <label for="zeit">Dauer des Anstiegs in Minuten:</label>
            <input type="number" id="zeit" value="20">
        </div>

        <div class="input-group">
            <label for="kurbel">Anzahl der Zähne an der Kurbel:</label>
            <input type="number" id="kurbel" value="50">
        </div>

        <div class="input-group">
            <label for="kassette">Anzahl der Zähne an der Kassette:</label>
            <input type="number" id="kassette" value="17">
        </div>

        <button onclick="berechneWattUndKadenz()">Berechnen</button>
        <h3>Benötigte Leistung: <span id="ergebnis">0</span> Watt</h3>
        <h3>Kadenz: <span id="kadenz">0</span> U/min</h3>
				    </div>

    <script>
        function parseGPX() {
            const fileInput = document.getElementById("gpxFile");
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(event.target.result, "text/xml");
                const trkpts = xmlDoc.getElementsByTagName("trkpt");
                
                let totalTime = 0;
                let totalWork = 0;
                let prevLat = null, prevLon = null, prevEle = null, prevTime = null;
                const R = 6371000; 
                const g = 9.81;
                const gewicht = parseFloat(document.getElementById("gewicht").value);
                
                for (let i = 1; i < trkpts.length; i++) {
                    const lat = parseFloat(trkpts[i].getAttribute("lat"));
                    const lon = parseFloat(trkpts[i].getAttribute("lon"));
                    const ele = parseFloat(trkpts[i].getElementsByTagName("ele")[0].textContent);
                    const time = new Date(trkpts[i].getElementsByTagName("time")[0].textContent).getTime();
                    
                    if (prevLat !== null && prevLon !== null && prevEle !== null && prevTime !== null) {
                        const dLat = (lat - prevLat) * Math.PI / 180;
                        const dLon = (lon - prevLon) * Math.PI / 180;
                        const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(prevLat * Math.PI / 180) * Math.cos(lat * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
                        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                        const distance = R * c;
                        const elevationGain = Math.max(0, ele - prevEle);
                        const segmentTime = (time - prevTime) / 1000;

                        if (segmentTime > 0) {
                            const velocity = distance / segmentTime;
                            const power = gewicht * g * (elevationGain / distance) * velocity;
                            totalWork += power * segmentTime;
                            totalTime += segmentTime;
                        }
                    }
                    prevLat = lat;
                    prevLon = lon;
                    prevEle = ele;
                    prevTime = time;
                }
                
                const avgPower = totalWork / totalTime;
                document.getElementById("ergebnis").innerText = avgPower.toFixed(2);
            };
            reader.readAsText(file);
        }

        function berechneWattUndKadenz() {
            const gewicht = parseFloat(document.getElementById("gewicht").value);
            const zeit = parseFloat(document.getElementById("zeit").value) * 60;
            const kurbel = parseFloat(document.getElementById("kurbel").value);
            const kassette = parseFloat(document.getElementById("kassette").value);
            
            if (isNaN(gewicht) || isNaN(zeit) || isNaN(kurbel) || isNaN(kassette)) {
                alert("Bitte alle Felder ausfüllen oder GPX-Datei hochladen!");
                return;
            }
            
            const avgPower = parseFloat(document.getElementById("ergebnis").innerText);
            const kadenz = (avgPower / (gewicht * 9.81)) * (kassette / kurbel) * 60;
            document.getElementById("kadenz").innerText = kadenz.toFixed(2);
        }
    </script>


				</section>

			<!-- Footer -->
				<footer id="footer">
					<div class="container">
						<!-- Copyright -->
							<div id="copyright">
								<ul class="menu">
									<li>&copy; Bike Werners. All rights reserved</li>
								</ul>
							</div>

					</div>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/wernerstats.js"></script>

	</body>
</html>
